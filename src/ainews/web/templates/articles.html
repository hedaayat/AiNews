{% extends "base.html" %}

{% block title %}Articles - Today's AI News{% endblock %}

{% block content %}
<h1 class="text-3xl font-bold mb-8">All Articles</h1>

<div class="bg-white rounded-lg shadow p-6 mb-8">
    <h2 class="text-lg font-semibold mb-4">Filters</h2>
    <form method="get" class="space-y-4">
        <div>
            <label class="block text-sm font-medium mb-2">Date</label>
            <input type="date" name="date" value="{{ current_date or '' }}" class="border rounded px-3 py-2 w-full">
        </div>
        <div>
            <label class="block text-sm font-medium mb-2">Source</label>
            <select name="source_id" class="border rounded px-3 py-2 w-full">
                <option value="">All sources</option>
                {% for source in sources %}
                <option value="{{ source.id }}" {% if current_source == source.id %}selected{% endif %}>{{ source.name }}</option>
                {% endfor %}
            </select>
        </div>
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Apply Filters</button>
    </form>
</div>

{% if articles %}
<div class="space-y-4 mb-8">
    {% for article in articles %}
    <div class="bg-white rounded-lg shadow p-6 hover:shadow-lg transition">
        <h3 class="text-lg font-semibold mb-2">{{ article.title }}</h3>
        <p class="text-sm text-gray-600 mb-2">
            From <span class="font-semibold">{{ article.source_id }}</span>
            {% if article.published_at %} • {{ article.published_at.strftime('%b %d') }}{% endif %}
        </p>
        <p class="text-gray-700 mb-4">{{ article.content[:300] }}{% if article.content|length > 300 %}...{% endif %}</p>
        <a href="{{ article.url }}" target="_blank" class="text-blue-600 hover:underline font-semibold">Read full article →</a>
    </div>
    {% endfor %}
</div>

<!-- Pagination -->
{% if total_pages > 1 %}
<div class="flex justify-center gap-2 mt-8">
    {% if page > 1 %}
    <a href="?page=1{% if current_date %}&date={{ current_date }}{% endif %}{% if current_source %}&source_id={{ current_source }}{% endif %}" class="px-3 py-2 border rounded hover:bg-gray-100">First</a>
    <a href="?page={{ page - 1 }}{% if current_date %}&date={{ current_date }}{% endif %}{% if current_source %}&source_id={{ current_source }}{% endif %}" class="px-3 py-2 border rounded hover:bg-gray-100">← Previous</a>
    {% endif %}

    <span class="px-3 py-2">Page {{ page }} of {{ total_pages }}</span>

    {% if page < total_pages %}
    <a href="?page={{ page + 1 }}{% if current_date %}&date={{ current_date }}{% endif %}{% if current_source %}&source_id={{ current_source }}{% endif %}" class="px-3 py-2 border rounded hover:bg-gray-100">Next →</a>
    <a href="?page={{ total_pages }}{% if current_date %}&date={{ current_date }}{% endif %}{% if current_source %}&source_id={{ current_source }}{% endif %}" class="px-3 py-2 border rounded hover:bg-gray-100">Last</a>
    {% endif %}
</div>
{% endif %}

{% else %}
<div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6 text-center">
    <p class="text-gray-700">No articles found. Try different filters.</p>
</div>
{% endif %}
{% endblock %}
